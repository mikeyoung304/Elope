!function(){"use strict";var e=document.currentScript;if(!e)return void console.error("[MAIS SDK] document.currentScript not supported");var t={tenant:e.getAttribute("data-tenant"),apiKey:e.getAttribute("data-api-key"),containerId:e.getAttribute("data-container")||"mais-widget",mode:e.getAttribute("data-mode")||"embedded"};if(!t.tenant||!t.apiKey)return void console.error("[MAIS SDK] Missing required attributes: data-tenant, data-api-key");if(!t.apiKey.match(/^pk_live_[a-z0-9-]+_[a-f0-9]{16}$/))return void console.error("[MAIS SDK] Invalid API key format");var n=-1!==e.src.indexOf("localhost")?"http://localhost:5173":"https://widget.mais.com";function i(e){this.config=e,this.iframe=null,this.container=null,this.loaded=!1,this.messageHandlers={},this._handleMessage=this._createMessageHandler()}i.prototype._createMessageHandler=function(){var e=this;return function(t){e.handleMessage(t)}},i.prototype.init=function(){if(this.container=document.getElementById(this.config.containerId),!this.container)return void console.error("[MAIS SDK] Container not found: #"+this.config.containerId);this.iframe=document.createElement("iframe"),this.iframe.src=this.buildWidgetUrl(),this.iframe.style.cssText="width: 100%;border: none;display: block;min-height: 600px;background: transparent;",this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("title","MAIS Wedding Booking Widget"),window.addEventListener("message",this._handleMessage),this.container.appendChild(this.iframe),console.log("[MAIS SDK] Widget initialized:",this.config.tenant)},i.prototype.buildWidgetUrl=function(){var e=["tenant="+encodeURIComponent(this.config.tenant),"apiKey="+encodeURIComponent(this.config.apiKey),"mode="+encodeURIComponent(this.config.mode),"parentOrigin="+encodeURIComponent(window.location.origin)];return n+"?"+e.join("&")},i.prototype.handleMessage=function(e){if(e.origin===n){var t=e.data;if(t&&"mais-widget"===t.source)switch(t.type){case"READY":this.loaded=!0,console.log("[MAIS SDK] Widget loaded"),this.emit("ready");break;case"RESIZE":this.iframe&&t.height&&(this.iframe.style.height=t.height+"px");break;case"BOOKING_CREATED":console.log("[MAIS SDK] Booking created:",t.bookingId),this.emit("bookingCreated",t);break;case"BOOKING_COMPLETED":console.log("[MAIS SDK] Booking completed:",t.bookingId),this.emit("bookingCompleted",t),t.returnUrl&&(window.location.href=t.returnUrl);break;case"ERROR":console.error("[MAIS SDK] Widget error:",t.error),this.emit("error",t);break;default:console.warn("[MAIS SDK] Unknown message type:",t.type)}}},i.prototype.sendMessage=function(e,t){if(!this.iframe||!this.iframe.contentWindow)return void console.warn("[MAIS SDK] Widget not ready");var i={source:"mais-parent",type:e};if(t)for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o]);this.iframe.contentWindow.postMessage(i,n)},i.prototype.on=function(e,t){this.messageHandlers[e]||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(t)},i.prototype.emit=function(e,t){for(var n=this.messageHandlers[e]||[],i=0;i<n.length;i++)n[i](t)},i.prototype.openBooking=function(e){this.sendMessage("OPEN_BOOKING",{packageSlug:e})},i.prototype.close=function(){this.sendMessage("CLOSE")},i.prototype.destroy=function(){window.removeEventListener("message",this._handleMessage),this.container&&this.iframe&&this.container.removeChild(this.iframe),this.iframe=null,this.loaded=!1};var o=new i(t);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){o.init()}):o.init(),window.MAISWidget=o}();
